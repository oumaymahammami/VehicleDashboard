<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <style>
        :root{
            --bg:#071027; --card:rgba(12,18,28,0.85); --muted:#94a3b8;
            --accent1:#3b82f6; --accent2:#7c3aed; --accent-gradient:linear-gradient(135deg,var(--accent1),var(--accent2));
            --glass: rgba(255,255,255,0.04);
            --glass-strong: rgba(255,255,255,0.06);
        }
        *{box-sizing:border-box}
        body{font-family:Inter,system-ui,Segoe UI,Roboto,-apple-system,Arial;margin:0;background:linear-gradient(180deg,#041026 0%, #071430 100%);color:#e6eef8;min-height:100vh;-webkit-font-smoothing:antialiased}
        .wrap{max-width:1200px;margin:36px auto;padding:28px}
        header{display:flex;align-items:center;justify-content:space-between;margin-bottom:22px}
        .brand{display:flex;gap:14px;align-items:center}
        .logo{width:64px;height:64px;border-radius:12px;background:var(--accent-gradient);display:flex;align-items:center;justify-content:center;font-weight:800;box-shadow:0 10px 30px rgba(59,130,246,0.16);font-size:20px;color:white}
        .title{font-size:20px;font-weight:800;letter-spacing:0.2px}
        .subtitle{font-size:13px;color:var(--muted);margin-top:3px}
        .controls{display:flex;gap:12px;align-items:center}
        .chip{background:transparent;padding:8px 12px;border-radius:999px;font-size:13px;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}
        main{display:grid;grid-template-columns:1fr 380px;gap:20px}
        .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 8px 36px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(6px);transition:transform .18s ease,box-shadow .18s ease}
        .panel:hover{transform:translateY(-4px);box-shadow:0 18px 50px rgba(2,6,23,0.65)}
        .kpis{display:flex;gap:14px;margin-bottom:14px}
        .kpi{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;color:#dbeafe;display:flex;flex-direction:column;justify-content:center;align-items:flex-start;border-left:4px solid transparent;transition:transform .18s ease,box-shadow .18s ease}
        .kpi:hover{transform:translateY(-6px)}
        .kpi .label{font-size:12px;color:var(--muted)}
        .kpi .value{font-size:22px;font-weight:800;margin-top:6px;color:#f8fafc}
        .kpi.temp{border-left-color:var(--accent1);background:linear-gradient(180deg, rgba(59,130,246,0.04), rgba(124,58,237,0.02))}
        .kpi.hum{border-left-color:#06b6d4;background:linear-gradient(180deg, rgba(6,182,212,0.03), rgba(6,182,212,0.01))}
        .kpi.alt{border-left-color:#f59e0b;background:linear-gradient(180deg, rgba(245,158,11,0.03), rgba(245,158,11,0.01))}
        table{width:100%;border-collapse:collapse;margin-top:10px;background:transparent}
        th,td{padding:10px 12px;text-align:left}
        thead th{font-size:13px;color:var(--muted);font-weight:700}
        tbody tr{background:transparent;border-top:1px solid rgba(255,255,255,0.03)}
        tbody td{font-size:14px}
        .aside{display:flex;flex-direction:column;gap:12px}
        .led-box{display:flex;align-items:center;gap:12px;padding:12px;background:linear-gradient(90deg, rgba(59,130,246,0.06), rgba(124,58,237,0.04));border-radius:10px}
        #led-container{min-width:42px;height:42px;display:flex;align-items:center;justify-content:center}
        .led{width:20px;height:20px;border-radius:50%;box-shadow:0 6px 18px rgba(0,0,0,0.6)}
        .led.red{background:#ef4444;box-shadow:0 8px 28px rgba(239,68,68,0.24)}
        .led.blue{background:#38bdf8;box-shadow:0 8px 28px rgba(56,189,248,0.16)}
        .led.green{background:#10b981;box-shadow:0 8px 28px rgba(16,185,129,0.18)}
        .led.orange{background:#f59e0b;box-shadow:0 8px 28px rgba(245,158,11,0.18)}
        .pulse{animation:pulse 1.6s infinite}
        @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.4);opacity:0.7}100%{transform:scale(1);opacity:1}}
        .map-placeholder, #map{height:360px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:14px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
        footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
        @media (max-width:980px){main{grid-template-columns:1fr} .aside{order:2}}
    </style>
</head>
<body>
<div class="wrap">
    <header>
        <div class="brand">
            <div class="logo">VD</div>
            <div>
                <div class="title">Vehicle Dashboard</div>
                <div class="subtitle">Visualisation temps réel des véhicules</div>
            </div>
        </div>
        <div class="controls">
            <div class="chip">Local</div>
            <div class="chip">Simulé</div>
            <div id="firebase-status" class="chip">Firebase: --</div>
            <button id="toggle-auto-leds" class="chip" style="cursor:pointer;background:transparent;border:1px solid rgba(255,255,255,0.03);">Auto LEDs: On</button>
        </div>
    </header>

    <main>
        <section class="panel">
            <div class="kpis">
                <div class="kpi temp"><div class="label">Température</div><div id="kpi-temp" class="value">-- °C</div></div>
                <div class="kpi hum"><div class="label">Humidité</div><div id="kpi-hum" class="value">-- %</div></div>
                <div class="kpi alt"><div class="label">Altitude</div><div id="kpi-alt" class="value">-- m</div></div>
            </div>

            <table>
                <thead>
                <tr>
                    <th>Latitude</th><th>Longitude</th><th>Altitude</th><th>Température</th><th>Humidité</th><th>Timestamp</th>
                </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
            <footer>Dernière mise à jour : <span id="last-updated">--</span></footer>
        </section>

        <aside class="aside">
            <div class="panel led-box">
                <div style="flex:1">
                    <div style="font-size:13px;color:var(--muted)">Alertes</div>
                    <div style="font-weight:700;margin-top:6px">État du véhicule</div>
                </div>
                <div id="led-container"></div>
                <div id="led-db-display" style="font-size:12px;color:var(--muted);margin-top:6px">DB: --</div>
            </div>

            <div class="panel">
                <div id="map" class="map-placeholder">Chargement de la carte...</div>
            </div>

            <div class="panel" style="text-align:center;color:var(--muted)">
                <div style="font-weight:600">Risque Routier</div>
                <div id="risk-level" style="font-size:14px;margin-top:6px">--</div>
                <div id="model-pred" style="font-size:13px;color:var(--muted);margin-top:6px">Model: --</div>
            </div>
        </aside>

        <section class="panel" id="stats-panel" style="margin-top:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Statistiques historiques</div>
            <div style="display:flex;gap:8px">
              <button id="refresh-stats" style="background:var(--accent1);color:white;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;box-shadow:0 8px 24px rgba(59,130,246,0.18);transition:transform .12s ease,opacity .12s ease">⟳ Rafraîchir</button>
            </div>
          </div>

          <div style="margin-top:12px;display:grid;gap:12px">
            <div style="display:flex;gap:12px;align-items:center">
              <div style="flex:1;background:var(--card);padding:12px;border-radius:10px;">
                <div style="font-size:13px;color:var(--muted)">Température moyenne</div>
                <div id="avg-temp" style="font-weight:700;font-size:18px;margin-top:6px">-- °C</div>
              </div>
              <div style="flex:1;background:var(--card);padding:12px;border-radius:10px;">
                <div style="font-size:13px;color:var(--muted)">Humidité moyenne</div>
                <div id="avg-hum" style="font-weight:700;font-size:18px;margin-top:6px">-- %</div>
              </div>
              <div style="width:140px;background:var(--card);padding:12px;border-radius:10px;text-align:center;">
                <div style="font-size:13px;color:var(--muted)">Risques élevés</div>
                <div id="high-risk-count" style="font-weight:700;font-size:18px;margin-top:6px">--</div>
              </div>
            </div>

            <div style="font-size:13px;color:var(--muted)">Zones à risque: <span id="stats-zones">--</span></div>

            <div>
              <div style="font-weight:600;margin-bottom:6px">Zones fréquentes à haut risque</div>
              <table id="zones-table" style="width:100%">
                <thead>
                  <tr><th>Zone (lat,lon)</th><th>Occurrences</th></tr>
                </thead>
                <tbody>
                  <!-- remplis par app.js -->
                </tbody>
              </table>
            </div>

            <div style="text-align:right;color:var(--muted);font-size:13px">Dernière actualisation des stats : <span id="stats-last-refreshed">--</span></div>

          </div>
        </section>
    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>

<!-- Leaflet.js -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

<script type="module" src="app.js"></script>
</body>
</html>
